---
import ExternalType from '../components/ExternalType.astro';
import Rating from '../components/Rating.astro';

const { post, first, includeNote = true } = Astro.props;
const dateObject = new Date(post.postDate);
const formattedDate = dateObject.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<article class={first ? '-first' : ''}>
  <h3 class="text-h4"><a href={ post.externalLink } class="basic-link">{post.title}</a></h3>
  {post.sourceAuthor && (
    <div class="article-author text-meta">by {post.sourceAuthor}</div>
  )}
  <div class="article-meta">
    <time datetime={ formattedDate } class="text-label">{ formattedDate }</time>
    {post.rating && (
      <Rating rating={post.rating} />
    )}
    {post.externalType && (
      <ExternalType type={post.externalType} />
    )}
    {post.categories.length > 0 && (
      post.categories.map((category) => (
        <a href={ '/journal/category/' + category.slug } class="pill">{category.title}</a>
      ))
    )}
  </div>
  {includeNote && post.note && (
    <div class="link-note" set:html={post.note} />
  )}
</article>

<style scoped>
  article {
    h2 {
      text-transform: capitalize;
    }

    .link-note {
      max-width: 50ch;
      corner-shape: squircle;
      padding: var(--spacing-xs);
      border-radius: var(--radius);
      background-color: var(--color-gray);
      margin-block-start: var(--spacing-s);

      &:has(blockquote) {
        max-width: 60ch;
        background-color: var(--color-highlight-hover);
      }
      p {
        font-size: var(--step--1);
      }

      blockquote {
        margin-inline: 0;
        padding-inline: 0;

        p {
          font-style: italic;
          font-size: var(--step-0);
        }
      }
    }
  }
</style>