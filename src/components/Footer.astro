---
import { getEntry } from '../utils/craftApi';
import { FOOTER_QUERY } from '../utils/queries';
import Smiley from '../assets/smiley.svg';
import Arrow from '../assets/arrow.svg';
import UsFlag from '../assets/us-in-distress.svg';

const footer = await getEntry(FOOTER_QUERY);
const links: FooterLink[] = footer.links ?? [];
---

<footer class="site-footer">
  <div class="background-noise"></div>
  <div class="site-footer-content">
    <div>      
      {footer.linksIntro && (
        <h3 class="text-body link-list-intro">{footer.linksIntro.plainText}</h3>
      )}
      <ul class="link-list" role="list">
        {links.map((link) => (
          <li>
            <a
              href={link.linkField.url}
              target={link.linkField.target}
              class={'pill pill--lg contrast-color ' + link.linkField.class}
              id={link.linkField.id}
              style={`--color-pill: ${link.linkColor};`}
              data-tippy-content={link.tooltip?.rawHtml}
            >
              {link.linkField.label}
              {link.linkField.target === '_blank' && (
                <>
                  <span class="visually-hidden">.</span>
                  <span aria-label="Opens in new tab."><Arrow /></span>
                </>
              )}
            </a>
          </li>
        ))}
      </ul>
    </div>
    <div class="flex items-center justify-center gap-s mt-l">
      <Smiley />
    </div>
    <div class="fine-print text-meta">
     <p>Â© {new Date().getFullYear()} Matt Soria</p>
     <p>This site does not use cookies or track you in any way.:peace:</p>
    </div>
  </div>
</footer>

<style scoped>
	.site-footer {
    overflow: hidden;
    position: relative;
    text-align: center;
		padding: var(--spacing-3xl) var(--spacing-l) var(--spacing-4xl);
	}

  .background-noise {
    width: 100%;
    opacity: 0.8;
    height: 350px;
    position: absolute;
    inset-block-end: 0;
    inset-inline-start: 0;
    mix-blend-mode: darken;
    filter: contrast(530%) brightness(250%) saturate(27%);
    background: 
    linear-gradient(0deg, oklch(var(--color-gradient-parts) / 0.8), oklch(var(--color-gradient-parts) / 0)),
    url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'%3E%3C/feColorMatrix%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
  }

  .site-footer-content {
    z-index: 1;
    display: grid;
    position: relative;
    row-gap: var(--spacing-l);
  }

  .link-list-intro {
    text-align: center;
  }

  .link-list {
    display: flex;
    flex-wrap: wrap;
    margin-inline: auto;
    text-wrap: balance;
    justify-content: center;
    max-width: 70ch;
    
    li {
      display: inline-block;
      margin-block-start: var(--spacing-xs);

      + li {
        margin-inline-start: var(--spacing-xs);
      }
    }
  }

  .fine-print {
    p + p {
      margin-block-start: var(--spacing-3xs);
    }
  }

  .smiley {
    @media screen and (prefers-reduced-motion: no-preference) {
      &:hover {
        filter: url("#distortionFilter");
      }
    }
  }

	.smiley, .us-flag{
		width: var(--spacing-l);
	}
</style>
