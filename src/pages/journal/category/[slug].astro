---
import Journal from '../../../layouts/Journal.astro';
import { getEntries } from '../../../utils/craftApi';
import { JOURNAL_CATEGORIES_QUERY, journalEntriesByCategoryQuery, journalLinksByCategoryQuery } from '../../../utils/queries';

export async function getStaticPaths() {
  const entries = await getEntries(JOURNAL_CATEGORIES_QUERY);
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry }, // Pass the full entry data as props
  }));
}

const { entry } = Astro.props;

const posts = await getEntries(journalEntriesByCategoryQuery(entry.id));

// Fetch links separately with error handling
let links = [];
try {
  links = await getEntries(journalLinksByCategoryQuery(entry.id));
} catch (error) {
  console.warn('Could not fetch journal links for category:', error);
}
---

<Journal title={'Journal: ' + entry.title} posts={posts} links={links} />
